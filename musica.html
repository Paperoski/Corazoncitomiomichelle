<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale-1" />
  <title>Nuestra Playlist Interactiva</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Estilos adicionales para la funcionalidad de m칰sica */
    #spotify-login, #spotify-content {
      display: none; /* Ocultos por defecto */
    }
    #search-input {
      width: 80%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.2);
      background-color: var(--light-glass);
      color: var(--text);
      font-size: 16px;
      margin-bottom: 20px;
    }
    #search-results {
      max-height: 300px;
      overflow-y: auto;
      text-align: left;
    }
    .track-item {
      display: flex;
      align-items: center;
      padding: 8px;
      border-radius: 8px;
      margin-bottom: 8px;
      transition: background-color 0.2s;
    }
    .track-item:hover {
      background-color: var(--dark-glass);
    }
    .track-item img {
      width: 50px;
      height: 50px;
      border-radius: 4px;
      margin-right: 12px;
    }
    .track-info p { margin: 0; }
    .track-info .track-name { font-weight: bold; }
    .track-info .track-artist { font-size: 14px; opacity: 0.8; }
    .add-track-btn {
      margin-left: auto;
      background: var(--accent);
      border: none;
      color: white;
      font-weight: bold;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      font-size: 20px;
      cursor: pointer;
    }
    #playlist-container { margin-top: 20px; }
  </style>
</head>
<body>
    <div class="bgmedia"><img src="imagenes/minecraftfondo1.gif" alt="Fondo Rom치ntico" /></div>

    <nav class="main-nav">
        <a href="index.html" class="home-link">游눘</a>
        <a href="tiempo.html">Tiempo</a>
        <a href="frases.html">Frases</a>
        <a href="musica.html" class="active">M칰sica</a>
        <a href="juego.html">Juego</a>
    </nav>

    <div class="stage">
        <div class="content-card music-container">
            <h2>Nuestra Playlist Interactiva</h2>

            <div id="spotify-login">
                <p>Para buscar y a침adir canciones, necesitamos tu permiso.</p>
                <button id="login-button" class="btn">Conectar con Spotify</button>
            </div>

            <div id="spotify-content">
                <input type="text" id="search-input" placeholder="Busca una canci칩n o artista...">
                <div id="search-results"></div>
                <hr style="border-color: rgba(255,255,255,0.1); margin: 20px 0;">
                <h3>Nuestra Playlist Actual</h3>
                <div id="playlist-container">
                    </div>
            </div>
        </div>
    </div>
  
    <div class="footer">Dise침ado con todo mi amor para ti 游눘</div>

    <script>
        // ------------------------------------------------------------------
        // --- CONFIGURACI칍N - 춰REEMPLAZA ESTOS VALORES! ---
        // ------------------------------------------------------------------
        const clientId = '5ce96882dde14717be9edfde38603f1e'; // <-- Pega tu Client ID aqu칤
        const playlistId = '25i6n35Yn588yL24t5frvL';     // <-- Pega el ID de tu playlist aqu칤
        // ------------------------------------------------------------------

        const redirectUri = window.location.origin + window.location.pathname;
        let accessToken = null;

        // Al cargar la p치gina, revisamos si venimos de la redirecci칩n de Spotify
        document.addEventListener('DOMContentLoaded', () => {
            const args = new URLSearchParams(window.location.hash.substring(1));
            const token = args.get('access_token');

            if (token) {
                accessToken = token;
                showContent();
                refreshPlaylist();
            } else {
                showLogin();
            }
        });

        function showLogin() {
            document.getElementById('spotify-login').style.display = 'block';
            document.getElementById('spotify-content').style.display = 'none';
        }

        function showContent() {
            document.getElementById('spotify-login').style.display = 'none';
            document.getElementById('spotify-content').style.display = 'block';
        }

        // Evento para el bot칩n de login
        document.getElementById('login-button').addEventListener('click', () => {
            const scope = 'playlist-modify-public playlist-modify-private';
            let url = 'https://accounts.spotify.com/authorize';
            url += '?response_type=token';
            url += '&client_id=' + encodeURIComponent(clientId);
            url += '&scope=' + encodeURIComponent(scope);
            url += '&redirect_uri=' + encodeURIComponent(redirectUri);
            window.location = url;
        });

        // Evento para el buscador
        let searchTimeout;
        document.getElementById('search-input').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value;
            if (query.length > 2) {
                searchTimeout = setTimeout(() => searchTracks(query), 500);
            } else {
                document.getElementById('search-results').innerHTML = '';
            }
        });

        // Funci칩n para buscar canciones
        async function searchTracks(query) {
            const response = await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(query)}&type=track&limit=10`, {
                headers: { 'Authorization': `Bearer ${accessToken}` }
            });
            const data = await response.json();
            displayResults(data.tracks.items);
        }

        // Funci칩n para mostrar resultados
        function displayResults(tracks) {
            const resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = '';
            tracks.forEach(track => {
                const trackItem = document.createElement('div');
                trackItem.className = 'track-item';
                trackItem.innerHTML = `
                    <img src="${track.album.images[track.album.images.length - 1].url}" alt="츼lbum">
                    <div class="track-info">
                        <p class="track-name">${track.name}</p>
                        <p class="track-artist">${track.artists.map(a => a.name).join(', ')}</p>
                    </div>
                    <button class="add-track-btn" data-uri="${track.uri}">+</button>
                `;
                resultsContainer.appendChild(trackItem);
            });
        }
        
        // Evento para a침adir canciones (usando delegaci칩n de eventos)
        document.getElementById('search-results').addEventListener('click', (e) => {
            if (e.target && e.target.classList.contains('add-track-btn')) {
                const trackUri = e.target.dataset.uri;
                addTrackToPlaylist(trackUri);
            }
        });

        // Funci칩n para a침adir una canci칩n a la playlist
        async function addTrackToPlaylist(trackUri) {
            await fetch(`https://api.spotify.com/v1/playlists/${playlistId}/tracks`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ uris: [trackUri] })
            });
            alert('춰Canci칩n a침adida! 仇벒잺');
            // Limpia la b칰squeda y refresca la vista de la playlist
            document.getElementById('search-input').value = '';
            document.getElementById('search-results').innerHTML = '';
            refreshPlaylist();
        }

        // Funci칩n para refrescar el iframe de la playlist
        function refreshPlaylist() {
            const container = document.getElementById('playlist-container');
            const iframe = document.createElement('iframe');
            iframe.src = `https://open.spotify.com/embed/playlist/${playlistId}`;
            iframe.allow = "encrypted-media";
            iframe.loading = "lazy";
            container.innerHTML = ''; // Limpia el contenedor
            container.appendChild(iframe); // A침ade el nuevo iframe
        }
    </script>
</body>
</html>


